name: 导出 Docker 镜像

on:
  # 允许手动触发，提供输入参数
  workflow_dispatch:
    inputs:
      image_name:
        description: '要导出的完整 Docker 镜像名称 (如 nginx:alpine)'
        required: true
        default: 'nginx:latest'
      export_name:
        description: '导出的文件名 (无需后缀)'
        required: false
        default: 'docker-image-export'

jobs:
  export-image:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取 Docker 镜像
        run: docker pull ${{ inputs.image_name }}

      - name: 将镜像保存为 Tar 文件
        run: docker save ${{ inputs.image_name }} -o /tmp/${{ inputs.export_name }}.tar

      - name: 上传构件以供下载
        uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.export_name }}
          path: /tmp/${{ inputs.export_name }}.tar
          retention-days: 7 # 构件保留天数
